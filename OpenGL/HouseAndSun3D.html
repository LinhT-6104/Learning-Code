<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>COMP 274 - Đồ họa máy tính</title>

    <script src="glsim.js"></script> <!-- load the OpenGL 1.1 simulation code -->
    
    <script>
        let rotateX = 0;
        let rotateY = 0;
        let rotateZ = 0;    

        // ------------------- functions for drawing the cube -------------------
        function square(x, y, z, w, h, l, color = [255, 255, 0]) {
            glPushMatrix();
            glTranslatef(x,y,1);
            glColor3ubv(color);

            glBegin(GL_QUADS);
            glVertex3f(x-w/2, y-h/2, z + l/2);
            glVertex3f(x-w/2, y+h/2, z + l/2);
            glVertex3f(x+w/2, y+h/2, z + l/2);
            glVertex3f(x+w/2, y-h/2, z + l/2);
            glEnd();

            glPopMatrix();
        }

        function uvSphere(radius, slices, stacks) {
            var i,j;
            for (j = 0; j < stacks; j++) {
                var latitude1 = (Math.PI/stacks) * j - Math.PI/2;
                var latitude2 = (Math.PI/stacks) * (j+1) - Math.PI/2;
                var sinLat1 = Math.sin(latitude1);
                var cosLat1 = Math.cos(latitude1);
                var sinLat2 = Math.sin(latitude2);
                var cosLat2 = Math.cos(latitude2);
                glBegin(GL_TRIANGLE_STRIP);
                for (i = 0; i <= slices; i++) {
                    var longitude = (2*Math.PI/slices) * i;
                    var sinLong = Math.sin(longitude);
                    var cosLong = Math.cos(longitude);
                    var x1 = cosLong * cosLat1;
                    var y1 = sinLong * cosLat1;
                    var z1 = sinLat1;
                    var x2 = cosLong * cosLat2;
                    var y2 = sinLong * cosLat2;
                    var z2 = sinLat2;
                    glNormal3d(x2,y2,z2);
                glVertex3d(radius*x2,radius*y2,radius*z2);
                glNormal3d(x1,y1,z1);
                    glVertex3d(radius*x1,radius*y1,radius*z1);
                }
                glEnd();
            }
        }

        function maiNha(x, y, z, w, h, l, color = [255, 0, 0]) {
            glPushMatrix();
            glColor3ubv(color);

            glBegin(GL_POLYGON);    // Left face
            glVertex3f(x-w/2, y+h, z);
            glVertex3f(x-w/2, y, z+l/2);
            glVertex3f(x-w/2, y, z-l/2);
            glEnd();    
            
            glBegin(GL_POLYGON);    // Right face
            glVertex3f(x+w/2, y+h, z);
            glVertex3f(x+w/2, y, z+l/2);
            glVertex3f(x+w/2, y, z-l/2);
            glEnd();

            glBegin(GL_POLYGON);    // Font face
            glVertex3f(x-w/2, y+h, z);
            glVertex3f(x+w/2, y+h, z);
            glVertex3f(x+w/2, y, z+l/2);
            glVertex3f(x-w/2, y, z+l/2);
            glEnd();
            glPopMatrix();

            glBegin(GL_POLYGON);    // Font face
            glVertex3f(x-w/2, y+h, z);
            glVertex3f(x+w/2, y+h, z);
            glVertex3f(x+w/2, y, z-l/2);
            glVertex3f(x-w/2, y, z-l/2);
            glEnd();
            glPopMatrix();
        }

        function house(color = [255, 255, 0]) {

            glPushMatrix();
            maiNha(0,100,0, 340, 70, 260);

            square(0, 0, 0, 280, 200, 198);    // house front face
            square(0, -20, 0, 80, 120, 199, [0, 128, 0]); // house door
            square(46, 10, 0, 40, 40, 199, [0, 128, 0]);
            square(-46, 10, 0, 40, 40, 199, [0, 128, 0]);

            glPushMatrix();
            glRotatef(-90, 1, 0, 0);
            square(0, 0, 0, 340, 260, 198, [255, 0, 0]);    // house top face
            glPopMatrix();

            glPushMatrix();
            glRotatef(90, 1, 0, 0);
            square(0, 0, 0, 280, 200, 198);   // house  bot face
            glPopMatrix();
            
            glPushMatrix();
            glRotatef(180, 1, 0, 0);
            square(0, 0, 0, 280, 200, 198); // house back face
            glPopMatrix();

            glPushMatrix();
            glRotatef(90, 0, 1, 0);
            square(0, 0, 0, 200, 200, 278);   // house right face
            glPopMatrix();

            glPushMatrix();
            glRotatef(-90, 0, 1, 0);
            square(0, 0, 0, 200, 200, 278);   // house left face
            glPopMatrix();

            glPopMatrix();
        }

        // ----------------------------------------------------------------------

        function display() {
            glClear( GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

            glLoadIdentity();
            glRotatef(rotateZ, 0, 0, 1);
            glRotatef(rotateY, 0, 1, 0);
            glRotatef(rotateX, 1, 0, 0);

            house();
        }

        function initGL() {
            glMatrixMode(GL_PROJECTION);
            glOrtho(-300, 300, -300, 300, -1000, 1000);
            glMatrixMode(GL_MODELVIEW);
            glEnable(GL_DEPTH_TEST);
            glClearColor(1,1,1,1);
        }

        function doKeyDown(evt) {
        let key = evt.keyCode;
        if ( key == 39 ) // left
           rotateY -= 15;
        else if ( key == 37 ) // right
           rotateY += 15;
        else if ( key == 38) // down
           rotateX += 15;
        else if ( key == 40 ) // up
           rotateX -= 15;
        else if ( key == 34 ) // page up
           rotateZ += 15;
        else if ( key == 33 ) // page down
           rotateZ -= 15;
        else if ( key == 36 )  // home
           rotateX = rotateY = rotateZ = 0;
        if (key >=34 && key <= 40) {
            evt.preventDefault();
        }
        display();
    }

    function init() {  // Called by <body onload="init()">, when the page has loaded.
        try {
            glsimUse("glcanvas"); // OpenGL will display to the canvas with id="glcanvas".
        }
        catch (e) {
            document.getElementById("canvas-holder").innerHTML =
                "Sorry, an error occured:<br>" + e;
            return;
        }
        document.onkeydown = doKeyDown;
        initGL();
        display();
    }

        // window.onload = init;

    </script>

</head>

<body onload="init()">

    <h3>COMP 274 - Đồ họa máy tính</h3>

    <p>(Rotate using arrow keys, page up, page down, and home keys.)</p>

    <noscript>
        <p><b>Sorry, this page requires JavaScript!</b></p>
    </noscript>

    <div id="canvas-holder">
        <canvas id="glcanvas" width="600" height="600" style="border: solid 1px gray;"></canvas>
    </div>

</body>

</html>