<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>COMP 274 - Đồ họa máy tính</title>

    <script src="glsim.js"></script> <!-- load the OpenGL 1.1 simulation code -->
    <script>
        angle = 0;
        cartX = -450;
        frameNumber = 0;

        function transform() {
            glClear(GL_COLOR_BUFFER_BIT); // Fills the scene with blue.
            frameNumber += 1;
        }
        
        function drawQuads(x,y,w,h, color = [255, 255, 0]) {
            glPushMatrix();
            glBegin(GL_QUADS);
                glColor3ubv(color);
                glVertex2f(x-w/2, y-h/2);
                glVertex2f(x-w/2, y+h/2);
                glVertex2f(x+w/2, y+h/2);
                glVertex2f(x+w/2, y-h/2);
            glEnd();
            glPopMatrix();
        }
        
        function drawCircle(x,y,r,color = [255, 0, 0]) {
            glPushMatrix();
            glBegin( GL_POLYGON);
                glColor3ubv(color);
                for (let i = 0; i < 64; i++) {
                    let angle1 = (2 * Math.PI * i) / 64;  // 6.2832 represents 2*PI
                    let cx = x + r/2 * Math.cos(angle1);
                    let cy = y + r/2 * Math.sin(angle1);
                    glVertex2f(cx, cy);
                }
            glEnd();
            glPopMatrix();
        }
        
        function drawPoints(x,y,size,color = [0, 0, 0]) {
            glPointSize(size);
            glBegin(GL_POINTS);
                glColor3ubv(color);
                glVertex2f(x,y);
            glEnd();
        }
        
        function drawMountain() {
            glPushMatrix();
            glBegin(GL_POLYGON);
                glColor3ubv([0, 150, 30]);
                glVertex2f(-300, -300);
                glVertex2f(-300, -70);
                glVertex2f(-170, 15);
                glVertex2f(-145, -20);
                glVertex2f(-42, 60);
                glVertex2f(103, -80);
                glVertex2f(222, -30);
                glVertex2f(300, -70);
                glVertex2f(300, -300);
            glEnd();
            glPopMatrix();
        }
        
        function drawRoad() {
            glPushMatrix();
            drawQuads(0, -150, 600, 80, [100, 100, 150]);   // Lan duong
            drawQuads(0, -150, 600, 6, [255, 255, 255]);    // Vach trang
            glPopMatrix();
        }
        
        function drawLinesAround(x, y, r, numSpokes, color = [167, 167, 167]) {
            glPushMatrix();
            glBegin(GL_LINES);
                glColor3ubv(color);
                for (let i = 0; i < numSpokes; i++) {
                    let theta = 2 * Math.PI * i / numSpokes;
                    let lx = x + r * Math.sin(theta);
                    let ly = y - r * Math.cos(theta);
                    glVertex2f(x, y);
                    glVertex2f(lx, ly);
                }
            glEnd();
            glPopMatrix();
        }
        
        function drawWinmillBlades(x, y, w , h, color = [200, 100, 100]) {
            glPushMatrix();
                glColor3ubv(color);
                glTranslatef(x,y,0);
                glRotatef(angle, 0, 0, 1);
                for (let i = 0; i < 3; i++) {
                    glRotated(120, 0, 0, 1);
                    glBegin(GL_QUADS);
                        glVertex2f(0,0);
                        glVertex2f(-w/2, h/3);
                        glVertex2f(0, h);
                        glVertex2f(w/2, h/3);
                    glEnd();   
                }
            glPopMatrix();
        }
        
        function drawWinmill() {
            glPushMatrix();
                // Cot 1
                drawQuads(-236, 40, 10, 180, [170, 153, 153]);
                drawWinmillBlades(-236, 131, 11, 84);
                
                // Cot 2
                drawQuads(-112, 40, 10, 120, [170, 153, 153]);
                drawWinmillBlades(-112, 100, 8, 55);
                
                // Cot 3
                drawQuads(17, 35, 10, 210, [170, 153, 153]);
                drawWinmillBlades(17, 141, 14, 99);
            
            glPopMatrix();
        }
        
        function drawSun(x,y){
            glPushMatrix();
                glTranslated(x,y,0);
                glRotatef(angle,0,0,1);
                    drawLinesAround(0,0,70,10,[217,137,130]);
                    drawCircle(0, 0, 86, [212, 164, 112]);
                    drawCircle(0, 0, 82, [255, 255, 0]);
            glPopMatrix();
        }
        
        function drawVehicle(x,y) {
            glPushMatrix();
                glTranslatef(cartX, y, 0);
                // Banh ben phai
                glPushMatrix();
                    glTranslatef(40, -32, 0);
                    glRotatef(angle, 0, 0, -1);
                        drawCircle(0, 0, 45, [0, 0, 0]);   // Vanh xe
                        drawCircle(0, 0, 36, [204, 204, 204]); // Ben trong vanh
                        drawLinesAround(0, 0, 18, 12); // Nan hoa
                        drawPoints(0, 0, 8);  // Cham tron
                glPopMatrix();
                
                // Banh ben trai
                glPushMatrix();
                    glTranslatef(-43, -32, 0);
                    glRotatef(angle, 0, 0, -1);
                        drawCircle(0, 0, 45, [0, 0, 0]);    // Vanh xe
                        drawCircle(0, 0, 36, [204, 204, 204]);  // Ben trong vanh
                        drawLinesAround(0, 0, 18, 12); // Nan hoa
                        drawPoints(0, 0, 8);   // Cham tron
                glPopMatrix();
                
                // Than xe
                drawQuads(0, 0, 155, 45, [255, 0, 0]);      // Than duoi
                drawQuads(-30, 34, 70, 24, [255, 0, 0]);    // Than tren
            glPopMatrix();
        }
        
        function transform() {
            angle += 0.3;
            cartX += 0.5;
        }
        
        function draw() {
            glClear(GL_COLOR_BUFFER_BIT);
            drawMountain();
            drawRoad();
            drawVehicle(-30, -120);
            drawWinmill();
            drawSun(170, 170);
            transform();
            if (cartX > 400) {
                cartX -= 900;
            }
            requestAnimationFrame(draw);
        }

        function initGL() {
            glClearColor(0.78, 0.78, 1, 1);
            // The next three lines set up the coordinates system.
            glMatrixMode(GL_PROJECTION);
            glLoadIdentity();
            glOrtho(-300, 300, -250, 250, -1, 1);
            glMatrixMode(GL_MODELVIEW);
            glEnable(GL_POINT_SMOOTH);
        }

        function init() {  // Called by <body onload="init()">, when the page has loaded.
            try {
                glsimUse("glcanvas"); // OpenGL will draw to the canvas with id="glcanvas".
            }
            catch (e) {
                document.getElementById("canvas-holder").innerHTML =
                    "Sorry, an error occured:<br>" + e;
                return;
            }
            initGL();
            draw();
        }

        window.onload = init;

    </script>

</head>

<body>

    <h3>COMP 274 - Đồ họa máy tính</h3>

    <noscript>
        <p><b>Sorry, this page requires JavaScript!</b></p>
    </noscript>

    <div id="canvas-holder">
        <canvas id="glcanvas" width="600" height="500" style="border: solid 1px gray;"></canvas>
    </div>

</body>

</html>